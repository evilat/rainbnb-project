<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RainBNB Onboarding</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <style>
      * {
        font-family: "inter", "inter Fallback", ui-sans-serif, system-ui,
          sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
          "Noto Color Emoji";
      }

      a {
        text-decoration: none;
      }

      html {
        scroll-behavior: smooth;
      }

      html,
      body {
        margin: 0;
        background-color: #0d0f1a;
        color: #f8f9fa;
      }

      body.no-scroll {
        overflow: hidden;
      }

      .main-header {
        display: flex;
        align-items: center;
        height: 100%;
        position: relative;
        background: #000000;
      }

      .main-header a {
        position: absolute;
        left: 50%;
        bottom: 0;
      }

      .main-content {
        position: relative;
        z-index: 2;
        padding: 60px 20px;
      }

      .crypto-title {
        font-size: 5rem;
        font-weight: 900;
        color: #ffffff;
        margin-bottom: 25px;
        text-align: left;
        font-family: "Poppins", sans-serif;
        letter-spacing: -2px;
        line-height: 0.9;
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.1),
          0 0 20px rgba(255, 193, 7, 0.1), 1px 1px 2px rgba(0, 0, 0, 0.3);
      }

      .crypto-title .bnb-text {
        color: #ffc107;
        text-shadow: 0 0 15px rgba(255, 193, 7, 0.4),
          0 0 30px rgba(255, 193, 7, 0.2), 1px 1px 2px rgba(0, 0, 0, 0.3);
      }

      .crypto-tagline {
        font-size: 1.5rem;
        color: #b8bcc8;
        margin-bottom: 30px;
        font-weight: 400;
        text-align: left;
        font-family: "Poppins", sans-serif;
        line-height: 1.4;
        max-width: 90%;
      }

      .app-screenshot {
        position: relative;
        max-width: 100%;
        height: auto;
        border-radius: 15px;
      }

      .stage-light-container {
        position: relative;
        display: inline-block;
      }
      .stage-light-container::after {
        content: "";
        position: absolute;
        top: -50vh;
        left: 70%;
        transform: translateX(-50%) perspective(100vh) rotateX(45deg);
        width: 800px;
        height: 900px;
        background: linear-gradient(
          180deg,
          rgba(26, 29, 43, 1) 0%,
          rgba(26, 29, 43, 0.8) 20%,
          rgba(26, 29, 43, 0.6) 40%,
          rgba(26, 29, 43, 0.4) 60%,
          rgba(26, 29, 43, 0.2) 80%,
          transparent 100%
        );
        filter: blur(25px);
        pointer-events: none;
        z-index: -1;
        animation: stage-light-flicker 4s ease-in-out infinite 0.5s;
      }
      .main-header::before {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 60%;
        background: linear-gradient(
          180deg,
          transparent 0%,
          rgba(26, 29, 43, 0.3) 25%,
          rgba(26, 29, 43, 0.5) 50%,
          rgba(26, 29, 43, 0.8) 75%,
          rgba(26, 29, 43, 1) 100%
        );
        pointer-events: none;
        z-index: 1;
      }

      @keyframes stage-light-flicker {
        0%,
        100% {
          opacity: 0.8;
        }
        25% {
          opacity: 1;
        }
        50% {
          opacity: 0.9;
        }
        75% {
          opacity: 0.95;
        }
      }

      @keyframes ambient-glow {
        0%,
        100% {
          opacity: 0.6;
        }
        50% {
          opacity: 0.9;
        }
      }

      .floating-particles {
        position: absolute;
        width: 100%;
        height: 100%;
        overflow: hidden;
        pointer-events: none;
      }

      .particle {
        position: absolute;
        background: rgba(255, 193, 7, 0.6);
        border-radius: 50%;
      }

      @media (max-width: 1200px) {
        .crypto-title {
          font-size: 4.5rem;
        }
        .crypto-tagline {
          font-size: 1.3rem;
        }
        .main-content {
          padding: 50px 20px;
        }
        .stage-light-container::after {
          width: 700px;
          height: 800px;
          transform: translateX(-50%) perspective(80vh) rotateX(40deg);
        }
      }

      @media (max-width: 992px) {
        .crypto-title {
          font-size: 4rem;
          text-align: center;
        }
        .crypto-tagline {
          font-size: 1.2rem;
          text-align: center;
          max-width: 100%;
        }
        .main-content {
          padding: 40px 20px;
        }
        .stage-light-container {
          margin-top: 30px;
          text-align: center;
        }
        .app-screenshot {
          max-width: 75%;
        }

        .stage-light-container::after {
          display: none;
        }
      }

      @media (max-width: 768px) {
        .crypto-title {
          font-size: 3.5rem;
          letter-spacing: -1px;
        }
        .crypto-tagline {
          font-size: 1.1rem;
        }
        .main-content {
          padding: 30px 15px;
        }
        .app-screenshot {
          max-width: 80%;
        }
      }

      @media (max-width: 576px) {
        .crypto-title {
          font-size: 2.8rem;
          letter-spacing: -0.5px;
        }
        .crypto-tagline {
          font-size: 1rem;
          line-height: 1.3;
        }
        .main-content {
          padding: 25px 15px;
        }
        .app-screenshot {
          max-width: 85%;
        }
      }

      @media (max-width: 480px) {
        .crypto-title {
          font-size: 2.4rem;
        }
        .crypto-tagline {
          font-size: 0.95rem;
        }
        .main-content {
          padding: 20px 12px;
        }
        .app-screenshot {
          max-width: 100%;
        }
      }

      .scroll-img {
        position: absolute;
        width: calc(1.375rem + 1.5vw);
        bottom: 10px;
        filter: brightness(0) invert(1) drop-shadow(0 0 8px white);
        animation: floatUpDown 3s ease-in-out infinite;
      }

      @keyframes floatUpDown {
        0%,
        100% {
          transform: translateY(0px) translateX(-50%);
        }
        50% {
          transform: translateY(-8px) translateX(-50%);
        }
      }

      .scroll-section {
        position: relative;
        height: 100dvh;
        overflow: hidden;
      }

      .scroll-container {
        height: 100dvh;
        overflow-y: hidden;
      }

      .step-card {
        scroll-snap-align: start;
        height: 100dvh;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #1a1d2b;
        padding: 2.5rem 0 0 0;
        color: white;
        border: none;
      }

      .step-content::-webkit-scrollbar {
        display: none;
      }

      .step-content {
        overflow: auto;
        text-align: left;
        max-height: 100dvh;
        width: 100vw;
        max-width: 100vw;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .store-badge {
        height: 40px;
        margin: 0.25rem;
        vertical-align: middle;
      }

      .step-img {
        width: 100%;
        max-width: 300px;
        margin-bottom: 1rem;
        border-radius: 0.5rem;
      }

      .side-nav {
        position: absolute;
        left: 10px;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        flex-direction: column;
        gap: 1rem;
        z-index: 999;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 1rem;
        padding: 1.5rem 0.5rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      }

      .side-nav button {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: #343a40;
        color: #fff;
        border: 2px solid transparent;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease-in-out;
      }

      .arrow-nav {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        display: flex;
        flex-direction: column;
        gap: 1rem;
        z-index: 999;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 1rem;
        padding: 1.5rem 0.5rem;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      }

      .arrow-nav button {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: #343a40;
        color: #fff;
        border: 2px solid transparent;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease-in-out;
        font-size: 1.5rem;
      }

      .arrow-nav button:hover {
        background-color: #ffc107;
        color: #000;
      }

      .arrow-nav button:disabled {
        opacity: 0.4;
        cursor: not-allowed;
      }

      .arrow-nav button:disabled:hover {
        background-color: #343a40;
        color: #fff;
      }

      .side-nav,
      .arrow-nav {
        transition: transform 0.6s cubic-bezier(0.19, 1, 0.22, 1),
          opacity 0.6s ease;
        opacity: 1;
      }

      .hidden-nav-left {
        transform: translateY(-50%) translateX(-80px) scale(0.5);
        opacity: 0.5;
        pointer-events: none;
      }

      .hidden-nav-right {
        transform: translateY(-50%) translateX(80px) scale(0.5);
        opacity: 0.5;
        pointer-events: none;
      }

      @media (min-width: 768px) {
        .step-content {
          padding: 1rem 0;
        }

        .step-img {
          max-width: 250px;
          width: 100%;
          border-radius: 0.75rem;
          flex-shrink: 0;
        }

        .step-content p {
          font-size: 1rem;
          max-height: 75vh;
          line-height: 1.6;
          width: 100%;
          max-width: 400px;
          margin-bottom: 2rem;
        }

        .step-content h3 {
          max-width: 100vw;
          font-size: 1.5rem;
          position: absolute;
          top: 4px;
          margin-bottom: 1rem;
        }

        .side-nav button.active {
          background-color: #ffc107;
          color: #000;
          transform: scale(1.2) translateX(10px);
          border-radius: 1rem;
        }

        .side-nav button:hover {
          background-color: #ffc107;
          color: #000;
        }
      }

      @media (max-width: 768px) {
        .step-card {
          padding: 0;
        }

        .step-content {
          padding: 0 3rem;
          text-align: left;
        }

        .step-img {
          margin-bottom: 0.5rem;
          max-width: 220px;
        }

        .step-content h3 {
          margin: 1rem 0rem 1rem;
          font-size: 1.25rem;
        }

        .step-content p {
          max-width: 220px;
          margin-bottom: 2rem;
        }

        .scroll-img {
          content: url("img/swipe-bottom.png");
        }

        .side-nav {
          left: 0;
          gap: 0.5rem;
          padding: 0.75rem 0.25rem;
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
          border-radius: 0 1rem 1rem 0;
        }

        .side-nav button {
          width: 25px;
          height: 25px;
          border: 1px solid transparent;
          font-size: 12px;
          font-weight: unset;
        }

        .side-nav button.active {
          background-color: #ffc107;
          color: #000;
          transform: scale(1.2) translateX(10px);
          border-radius: 0.75rem;
        }

        .arrow-nav {
          right: 0;
          gap: 0.5rem;
          padding: 0.75rem 0.25rem;
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
          border-radius: 1rem 0 0 1rem;
        }

        .arrow-nav button {
          width: 25px;
          height: 25px;
          border: 1px solid transparent;
          font-size: 0.75rem;
        }
      }
    </style>
  </head>
  <body>
    <header class="main-header">
      <div class="floating-particles" id="particles"></div>

      <div class="container-fluid main-content">
        <div class="row align-items-center min-vh-100">
          <div class="col-lg-6 col-md-12">
            <div class="ps-lg-4">
              <h1 class="crypto-title">
                Rain<span class="bnb-text">BNB</span>
              </h1>
              <p class="crypto-tagline">
                Learn how to earn money with RainBNB and discover the future of
                decentralized hospitality
              </p>
            </div>
          </div>

          <div class="col-lg-6 col-md-12">
            <div class="pe-lg-4">
              <div class="stage-light-container">
                <img
                  src="img/header-app-screenshot.png"
                  alt="RainBNB App Screenshot"
                  class="app-screenshot img-fluid"
                />
              </div>
            </div>
          </div>
        </div>
      </div>
      <a href="#stepSection"
        ><img
          class="scroll-img"
          id="scroll-img"
          src="img/scroll-bottom.png"
          alt="Scroll Down"
      /></a>
    </header>

    <section id="stepSection" class="scroll-section">
      <div class="side-nav hidden-nav-left" id="stepNav"></div>

      <div class="arrow-nav hidden-nav-right">
        <button id="arrowUp" disabled>↑</button>
        <button id="arrowDown" disabled>↓</button>
      </div>
      <div class="scroll-container" id="scrollContainer"></div>
    </section>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Particle Configuration Variables
      const PARTICLE_CONFIG = {
        maxParticles: 20, // Maximum number of particles on screen
        spawnRate: 500, // Milliseconds between particle spawns
        size: {
          min: 1, // Minimum particle size in pixels
          max: 3, // Maximum particle size in pixels
        },
        speed: {
          min: 4, // Minimum animation duration in seconds
          max: 8, // Maximum animation duration in seconds
        },
        direction: {
          startX: 0, // Starting X position (0-100%)
          endX: 100, // Ending X position (0-100%)
          startY: 100, // Starting Y position (100 = bottom of screen)
          endY: -10, // Ending Y position (-10 = above screen)
        },
        opacity: {
          start: 0, // Starting opacity
          peak: 1, // Peak opacity
          end: 0, // Ending opacity
        },
        lifetime: 8000, // Total particle lifetime in milliseconds
        color: "rgba(255, 193, 7, 0.6)", // Particle color
      };

      function createParticles() {
        const container = document.getElementById("particles");

        setInterval(() => {
          if (container.children.length < PARTICLE_CONFIG.maxParticles) {
            const particle = document.createElement("div");
            particle.className = "particle";

            const size =
              Math.random() *
                (PARTICLE_CONFIG.size.max - PARTICLE_CONFIG.size.min) +
              PARTICLE_CONFIG.size.min;
            particle.style.width = size + "px";
            particle.style.height = size + "px";

            particle.style.background = PARTICLE_CONFIG.color;

            const startX =
              Math.random() *
                (PARTICLE_CONFIG.direction.endX -
                  PARTICLE_CONFIG.direction.startX) +
              PARTICLE_CONFIG.direction.startX;
            particle.style.left = startX + "%";

            const duration =
              Math.random() *
                (PARTICLE_CONFIG.speed.max - PARTICLE_CONFIG.speed.min) +
              PARTICLE_CONFIG.speed.min;
            particle.style.animationDuration = duration + "s";

            const endX = startX + (Math.random() * 20 - 10);
            const animationName =
              "float-" +
              Date.now() +
              "-" +
              Math.random().toString(36).substr(2, 9);

            const keyframes = `
                    @keyframes ${animationName} {
                        0% {
                            transform: translateY(${
                              PARTICLE_CONFIG.direction.startY
                            }vh) translateX(0px);
                            opacity: ${PARTICLE_CONFIG.opacity.start};
                        }
                        10% {
                            opacity: ${PARTICLE_CONFIG.opacity.peak};
                        }
                        90% {
                            opacity: ${PARTICLE_CONFIG.opacity.peak};
                        }
                        100% {
                            transform: translateY(${
                              PARTICLE_CONFIG.direction.endY
                            }vh) translateX(${endX - startX}vw);
                            opacity: ${PARTICLE_CONFIG.opacity.end};
                        }
                    }
                `;

            const style = document.createElement("style");
            style.textContent = keyframes;
            document.head.appendChild(style);

            particle.style.animation = `${animationName} ${duration}s linear infinite`;
            container.appendChild(particle);

            setTimeout(() => {
              if (particle.parentNode) {
                particle.parentNode.removeChild(particle);
              }
              if (style.parentNode) {
                style.parentNode.removeChild(style);
              }
            }, PARTICLE_CONFIG.lifetime);
          }
        }, PARTICLE_CONFIG.spawnRate);
      }

      Top = document.documentElement.scrollTop = 0;
      document.addEventListener("DOMContentLoaded", () => {
        createParticles();

        const stepsData = [
          {
            title: "Install SafePal",
            body: [
              {
                type: "content",
                html: `Download SafePal from the 
        <a href="https://play.google.com/store/apps/details?id=io.safepal.wallet" style="text-decoration: none; " target="_blank">
          <img class="store-badge" src="img/playstore-badge.png" alt="Play Store Badge">
        </a> or 
        <a href="https://apps.apple.com/app/id1548297139" style="text-decoration: none; " target="_blank">
          <img class="store-badge" src="img/appstore-badge.svg" alt="App Store Badge">
        </a>`,
              },
            ],
          },
          {
            title: "Create Account",
            body: [
              { type: "img", src: "img/screenshots/start.jpg" },
              { type: "content", html: "Click create new wallet button" },
              { type: "img", src: "img/screenshots/password.jpg" },
              {
                type: "content",
                html: "Enter a 6 digit password and remember it, this will be used to verify you. It may also ask if you want to add a fingerprint for easier verification.",
              },
              { type: "img", src: "img/screenshots/ready-to-backup.jpg" },
              { type: "content", html: "Click Back up now" },
            ],
          },
          {
            title: "Backup mnemonic phrase",
            body: [
              { type: "img", src: "img/screenshots/backup.jpg" },
              { type: "content", html: "Select back up manually" },
              { type: "img", src: "img/screenshots/backup-manual.jpg" },
              {
                type: "content",
                html: `Check the three checkboxes and click 'Understood'. Then it will give you a 12-word mnemonic phrase. You can write it down or take a photo of it using another phone. After that, you will be asked to verify the phrase by entering it.`,
              },
            ],
          },
          {
            title: "Setup your wallet",
            body: [
              { type: "img", src: "img/screenshots/wallet.jpg" },
              {
                type: "content",
                html: "Right now your wallet will show many coins. Click the three dots as highlighted in the image.",
              },
              { type: "img", src: "img/screenshots/dropdown.jpg" },
              {
                type: "content",
                html: "In the dropdown, click 'Manage coins'. It will take you to a new screen.",
              },
              { type: "img", src: "img/screenshots/manage-coin.jpg" },
              {
                type: "content",
                html: "Deselect every coin from this list that is selected and then go to search.",
              },
              { type: "img", src: "img/screenshots/manage-coin-search.jpg" },
              { type: "content", html: "Search 'opbnb' here." },
              { type: "img", src: "img/screenshots/search-opbnb-coin.jpg" },
              {
                type: "content",
                html: "Select the first one from the list that says BNB (opBNB).",
              },
              { type: "img", src: "img/screenshots/wallet-ready.jpg" },
              { type: "content", html: "Your wallet will now look like this." },
            ],
          },
          {
            title: "Add Assets",
            body: [
              {
                type: "content",
                html: "Add BNB (opBNB) worth a minimum of 35 USDT. You can buy it through our WhatsApp helpline number: +1234567890.",
              },
            ],
          },
          {
            title: "Go to DApp",
            body: [
              { type: "img", src: "img/screenshots/explore-popup.jpg" },
              {
                type: "content",
                html: `Go to the Explore tab using bottom navigation. You will see this popup — checkmark "I know how to use DApps very well, skip this guide." Then the "View DApp Store" button will be enabled — click it.`,
              },
              { type: "img", src: "img/screenshots/explore.jpg" },
              {
                type: "content",
                html: "Click on the search bar and it will take you to a new page.",
              },
              { type: "img", src: "img/screenshots/explore-url.jpg" },
              {
                type: "content",
                html: "Type or paste this URL in the top address bar: <strong>getrise.pro</strong>",
              },
              { type: "img", src: "img/screenshots/explore-netwrok-opbnb.jpg" },
              {
                type: "content",
                html: "In the second search bar, type 'opBNB' and select the opBNB network. Then click 'Go' in the top-right corner next to the address bar.",
              },
              { type: "img", src: "img/screenshots/explore-warning.jpg" },
              {
                type: "content",
                html: "You'll see a warning — checkmark 'Don't remind me next time' if you don't want to receive it again, then click 'Confirm'. You'll be redirected to the DApp.",
              },
            ],
          },
          {
            title: "Register on RainBNB",
            body: [
              { type: "img", src: "img/screenshots/dapp-error.jpg" },
              {
                type: "content",
                html: "You may see this error — it's normal. Close it from the lower close button (not the upper one, as that exits the DApp).",
              },
              { type: "img", src: "img/screenshots/dapp-register.jpg" },
              {
                type: "content",
                html: "You will be redirected to the registration screen. Click the 'Register' button to pay the registration fee.",
              },
            ],
          },
        ];

        const scrollContainer = document.getElementById("scrollContainer");
        scrollContainer.innerHTML = "";

        stepsData.forEach((step, index) => {
          const card = document.createElement("div");
          card.className = "card step-card";

          const contentDiv = document.createElement("div");
          contentDiv.className = "step-content overflow-hidden";

          const title = document.createElement("h3");
          title.textContent = `Step ${index + 1}: ${step.title}`;
          contentDiv.appendChild(title);

          step.body.forEach((block) => {
            if (block.type === "content") {
              const p = document.createElement("p");
              p.innerHTML = block.html;
              contentDiv.appendChild(p);
            } else if (block.type === "img") {
              const img = document.createElement("img");
              img.src = block.src;
              img.alt = step.title;
              img.className = "step-img";
              contentDiv.appendChild(img);
            }
          });

          card.appendChild(contentDiv);
          scrollContainer.appendChild(card);
        });

        const nav = document.getElementById("stepNav");
        nav.innerHTML = "";

        stepsData.forEach((_, index) => {
          const btn = document.createElement("button");
          btn.setAttribute("data-step", index);
          btn.textContent = index + 1;
          if (index === 0) btn.classList.add("active");
          nav.appendChild(btn);
        });
      });

      let stepScrollInitialized = false;
      let lastScrollTop = 0;
      let scrollDownStartTime = null;
      let initTimeout = null;

      window.addEventListener("scroll", () => {
        const section = document.getElementById("stepSection");
        const sectionTop = section.offsetTop;
        const scrollY = window.scrollY || window.pageYOffset;
        const scrollingDown = scrollY > lastScrollTop;
        lastScrollTop = scrollY;

        if (stepScrollInitialized || scrollY < sectionTop) {
          scrollDownStartTime = null;
          clearTimeout(initTimeout);
          return;
        }

        if (scrollingDown) {
          if (!scrollDownStartTime) {
            scrollDownStartTime = Date.now();

            initTimeout = setTimeout(() => {
              if (!stepScrollInitialized) {
                stepScroll.init();
                stepScrollInitialized = true;
                setupInitialInputHandlers();
              }
            }, 100);
          }
        } else {
          scrollDownStartTime = null;
          clearTimeout(initTimeout);
        }
      });

      function setupInitialInputHandlers() {
        const onInitialStepWheel = (e) => {
          e.preventDefault();
          const direction = e.deltaY;

          removeInitialListeners();

          if (direction > 0) {
            stepScroll.scrollToStep(1);
          } else {
            window.scrollBy({ top: -94, left: 0, behavior: "smooth" });
            destroyStepScroll();
          }
        };

        let touchStartY = 0;

        const onTouchStart = (e) => {
          touchStartY = e.changedTouches[0].screenY;
        };

        const onTouchEnd = (e) => {
          const touchEndY = e.changedTouches[0].screenY;
          const deltaY = touchStartY - touchEndY;

          removeInitialListeners();

          if (deltaY > 50) {
            stepScroll.scrollToStep(1);
          } else if (deltaY < -50) {
            window.scrollBy({ top: -94, left: 0, behavior: "smooth" });
            destroyStepScroll();
          }
        };

        function removeInitialListeners() {
          window.removeEventListener("wheel", onInitialStepWheel);
          window.removeEventListener("touchstart", onTouchStart);
          window.removeEventListener("touchend", onTouchEnd);
        }

        setTimeout(() => {
          window.addEventListener("wheel", onInitialStepWheel, {
            passive: false,
          });
        }, 100);

        setTimeout(() => {
          window.addEventListener("touchstart", onTouchStart, {
            passive: false,
          });
          window.addEventListener("touchend", onTouchEnd, { passive: false });
        }, 300);
      }
    </script>
    <script>
      function destroyStepScroll() {
        if (typeof stepScroll !== "undefined" && stepScroll.destroy) {
          document
            .getElementById("scrollContainer")
            .scrollTo({ top: 0, behavior: "smooth" });
          stepScroll.destroy();
        }
        stepScrollInitialized = false;
      }

      let stepScroll = (() => {
        let container, steps, navButtons, stepHeight;
        let currentStep = 0;
        let scrollAnimationFrame = null;
        let lastWheelTime = 0;
        let touchStartY = 0;
        let touchEndY = 0;
        let stepTimeout;

        const listeners = [];

        const easeOutExpo = (t) => 1 - Math.pow(2, -10 * t) * (t < 1 ? 1 : 0);

        const scrollToStep = (step) => {
          if (step === currentStep || step < 0 || step >= steps.length) return;

          if (stepTimeout) {
            clearTimeout(stepTimeout);
          }

          if (step === 0) {
            const onStepZeroWheel = (e) => {
              e.preventDefault();
              const direction = e.deltaY;

              if (direction < 0) {
                cleanupListeners();
                window.scrollBy({ top: -94, left: 0, behavior: "smooth" });
                destroyStepScroll();
              } else if (direction > 0) {
                cleanupListeners();
                scrollToStep(1);
              }
            };

            let touchStartY = 0;

            const onTouchStart = (e) => {
              touchStartY = e.changedTouches[0].screenY;
            };

            const onTouchEnd = (e) => {
              const touchEndY = e.changedTouches[0].screenY;
              const deltaY = touchStartY - touchEndY;

              if (deltaY > 50) {
                cleanupListeners();
              } else if (deltaY < -50) {
                cleanupListeners();
                window.scrollBy({ top: -94, left: 0, behavior: "smooth" });
                destroyStepScroll();
              }
            };

            const cleanupListeners = () => {
              window.removeEventListener("wheel", onStepZeroWheel);
              window.removeEventListener("touchstart", onTouchStart);
              window.removeEventListener("touchend", onTouchEnd);
            };

            setTimeout(() => {
              window.addEventListener("wheel", onStepZeroWheel, {
                passive: false,
              });
            }, 100);

            setTimeout(() => {
              window.addEventListener("touchstart", onTouchStart, {
                passive: false,
              });
              window.addEventListener("touchend", onTouchEnd, {
                passive: false,
              });
            }, 300);
          }

          if (scrollAnimationFrame) {
            cancelAnimationFrame(scrollAnimationFrame);
            scrollAnimationFrame = null;
          }

          const start = container.scrollTop;
          const end = step * window.innerHeight;
          const change = end - start;
          const duration = 500;
          let startTime = null;

          const animateScroll = (timestamp) => {
            if (!startTime) startTime = timestamp;
            const time = timestamp - startTime;
            const progress = Math.min(time / duration, 1);
            const ease = easeOutExpo(progress);

            container.scrollTop = start + change * ease;

            if (
              window.scrollY + window.innerHeight <
              document.body.scrollHeight - 1
            ) {
              window.scrollTo({
                top: document.body.scrollHeight,
                behavior: "auto",
              });
            }

            if (progress < 1) {
              scrollAnimationFrame = requestAnimationFrame(animateScroll);
            } else {
              scrollAnimationFrame = null;
            }
          };

          scrollAnimationFrame = requestAnimationFrame(animateScroll);
          currentStep = step;

          updateNavUI(step);
        };

        const showNavs = () => {
          document
            .querySelector(".side-nav")
            ?.classList.remove("hidden-nav-left");
          document
            .querySelector(".arrow-nav")
            ?.classList.remove("hidden-nav-right");
        };

        const hideNavs = () => {
          document.querySelector(".side-nav")?.classList.add("hidden-nav-left");
          document
            .querySelector(".arrow-nav")
            ?.classList.add("hidden-nav-right");
        };

        const updateNavUI = (step) => {
          navButtons.forEach((btn) => btn.classList.remove("active"));
          navButtons[step].classList.add("active");

          document.getElementById("arrowUp").disabled = step === 0;
          document.getElementById("arrowDown").disabled =
            step === steps.length - 1;
        };

        const handleWheel = (e) => {
          const now = Date.now();
          if (now - lastWheelTime < 200) return;
          lastWheelTime = now;

          const direction = e.deltaY;

          const stepContent = steps[currentStep].querySelector(".step-content");
          if (
            stepContent &&
            stepContent.scrollHeight > stepContent.clientHeight
          ) {
            const atTop = stepContent.scrollTop === 0;
            const atBottom =
              stepContent.scrollTop + stepContent.clientHeight >=
              stepContent.scrollHeight - 1;

            if ((direction > 0 && !atBottom) || (direction < 0 && !atTop)) {
              return;
            }
          }

          if (direction > 0 && currentStep < steps.length - 1) {
            e.preventDefault();
            scrollToStep(currentStep + 1);
          } else if (direction < 0 && currentStep > 0) {
            e.preventDefault();
            scrollToStep(currentStep - 1);
          }
        };

        const handleKey = (e) => {
          if (e.key === "ArrowDown" && currentStep < steps.length - 1) {
            scrollToStep(currentStep + 1);
          } else if (e.key === "ArrowUp" && currentStep > 0) {
            scrollToStep(currentStep - 1);
          }
        };

        const handleTouchStart = (e) => {
          touchStartY = e.changedTouches[0].screenY;
        };

        let edgeSwipeDetected = false;

        const handleTouchEnd = (e) => {
          const touchEndY = e.changedTouches[0].screenY;
          const deltaY = touchStartY - touchEndY;

          const currentCard = steps[currentStep];
          const content = currentCard.querySelector(".step-content");
          if (!content) return;

          const threshold = 0.9;
          const isScrollable =
            content.scrollHeight > content.clientHeight * threshold;

          const atTop = content.scrollTop <= 0;
          const atBottom =
            content.scrollTop + content.clientHeight >=
            content.scrollHeight - 2;

          const swipingDown = deltaY > 50;
          const swipingUp = deltaY < -50;

          const wantsNext = swipingDown && currentStep < steps.length - 1;
          const wantsPrev = swipingUp && currentStep > 0;

          if (!isScrollable) {
            if (wantsNext) scrollToStep(currentStep + 1);
            else if (wantsPrev) scrollToStep(currentStep - 1);
            return;
          }

          const reachedEdgeAndWantsNext = swipingDown && atBottom && wantsNext;
          const reachedEdgeAndWantsPrev = swipingUp && atTop && wantsPrev;

          if (reachedEdgeAndWantsNext || reachedEdgeAndWantsPrev) {
            if (edgeSwipeDetected) {
              scrollToStep(currentStep + (reachedEdgeAndWantsNext ? 1 : -1));
              edgeSwipeDetected = false;
            } else {
              edgeSwipeDetected = true;
              clearTimeout(handleTouchEnd._resetTimeout);
              handleTouchEnd._resetTimeout = setTimeout(() => {
                edgeSwipeDetected = false;
              }, 1000);
            }
          } else {
            edgeSwipeDetected = false;
          }
        };

        let isTouchScrollingContent = false;

        const handleTouchMove = (e) => {
          const currentCard = steps[currentStep];
          const content = currentCard.querySelector(".step-content");

          if (!content) return;

          const touchY = e.changedTouches
            ? e.changedTouches[0].screenY
            : e.touches[0].screenY;
          const deltaY = touchStartY - touchY;

          const maxScroll = content.scrollHeight - content.clientHeight;

          if (content.scrollHeight > content.clientHeight) {
            const scrollTop = content.scrollTop;

            if (
              (deltaY > 0 && scrollTop >= maxScroll) ||
              (deltaY < 0 && scrollTop <= 0)
            ) {
              isTouchScrollingContent = false;
            } else {
              isTouchScrollingContent = true;
            }
          }

          if (isTouchScrollingContent) {
            if (e.cancelable) e.stopPropagation();
          } else {
            if (e.cancelable) e.preventDefault();
          }
        };

        const addListener = (target, event, handler, opts = false) => {
          target.addEventListener(event, handler, opts);
          listeners.push(() =>
            target.removeEventListener(event, handler, opts)
          );
        };

        const setupNavButtons = () => {
          navButtons.forEach((btn, i) => {
            addListener(btn, "click", () => scrollToStep(i));
          });
        };

        const setupEventListeners = () => {
          addListener(window, "wheel", handleWheel, { passive: true });
          addListener(window, "keydown", handleKey);
          addListener(container, "touchstart", handleTouchStart, {
            passive: false,
          });
          addListener(container, "touchend", handleTouchEnd, {
            passive: false,
          });
        };

        const setupArrowControls = () => {
          addListener(document.getElementById("arrowUp"), "click", () => {
            if (currentStep > 0) scrollToStep(currentStep - 1);
          });

          addListener(document.getElementById("arrowDown"), "click", () => {
            if (currentStep < steps.length - 1) scrollToStep(currentStep + 1);
          });
        };

        const init = () => {
          document.body.classList.add("no-scroll");
          document
            .querySelectorAll(".step-content")
            .forEach((el) => el.classList.remove("overflow-hidden"));
          container = document.getElementById("scrollContainer");
          steps = document.querySelectorAll(".step-card");
          navButtons = document.querySelectorAll("#stepNav button");

          setupNavButtons();
          setupEventListeners();
          setupArrowControls();
          updateNavUI(0);
          showNavs();
        };

        const destroy = () => {
          document.body.classList.remove("no-scroll");
          document
            .querySelectorAll(".step-content")
            .forEach((el) => el.classList.add("overflow-hidden"));
          listeners.forEach((remove) => remove());
          listeners.length = 0;
          scrollAnimationFrame && cancelAnimationFrame(scrollAnimationFrame);
          scrollAnimationFrame = null;
          currentStep = 0;
          hideNavs();
        };

        return {
          init,
          destroy,
          scrollToStep,
        };
      })();
    </script>
  </body>
</html>